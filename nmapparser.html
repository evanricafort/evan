<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nmap Parser & Sorter</title>
    <link href="profile.jpg" type="image/gif" rel="shortcut icon" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        // Original custom dark gray shades
                        gray: {
                            50: '#f9fafb', // New: Added for general light background
                            100: '#f3f4f6', // New: Added for button light background
                            300: '#d1d5db', // New: Added for light borders
                            400: '#9ca3af', // New: Added for subtle text in light mode
                            600: '#6b7280', // New: Added for empty state/subtle text in light mode
                            700: '#4b5563', // New: Added for hover/active elements in light mode
                            800: '#1f2937', // New: Added for dark text in light mode
                            850: '#1f2937',
                            900: '#111827',
                            950: '#030712',
                        },
                        emerald: {
                            600: '#059669', // New: Added for button in light mode
                            700: '#047857',
                            800: '#065f46',
                        },
                        // Additional colors for light mode text/buttons
                        red: {
                            400: '#b91c1c',
                        },
                        green: {
                            400: '#065f46',
                        },
                        blue: {
                            300: '#2563eb',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        /* Custom scrollbar for the textarea and table - Adjusted to use variables for both modes */
        :root {
            /* Dark Mode Defaults */
            --scrollbar-track: #1f2937;
            --scrollbar-thumb: #4b5563;
            --scrollbar-thumb-hover: #6b7280;
        }

        .light-mode {
            /* Light Mode Overrides */
            --scrollbar-track: #f3f4f6; /* gray-100 */
            --scrollbar-thumb: #9ca3af; /* gray-400 */
            --scrollbar-thumb-hover: #6b7280; /* gray-500 */
        }

        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: var(--scrollbar-track); 
        }
        ::-webkit-scrollbar-thumb {
            background: var(--scrollbar-thumb); 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: var(--scrollbar-thumb-hover); 
        }


        /* ---------------------------------------------------------------------- */
        /* LIGHT MODE FULL PAGE OVERRIDES */
        /* ---------------------------------------------------------------------- */

        .light-mode {
            /* Full Body/Page Background and Text Color */
            background-color: #f9fafb !important; /* gray-50 */
            color: #1f2937 !important; /* gray-800 */
        }
        
        /* Containers (Navbar, Input/Output area background) - from bg-gray-900 to white */
        .light-mode .bg-gray-900 { background-color: #ffffff !important; }
        /* Footer Border (from border-gray-800) */
        .light-mode .border-gray-800 { border-color: #e5e7eb !important; }
        /* Textarea/Output Container Border (from border-gray-700) */
        .light-mode .border-gray-700 { border-color: #d1d5db !important; }
        /* Textarea Text (from text-green-400 to dark text) */
        .light-mode .text-green-400 { color: #047857 !important; } /* emerald-700 */

        /* Text Colors */
        .light-mode .text-gray-200 { color: #1f2937 !important; } /* Body text */
        .light-mode .text-white { color: #1f2937 !important; } /* Title text */
        .light-mode .text-gray-400 { color: #6b7280 !important; } /* Subtle text */
        .light-mode .text-gray-600 { color: #9ca3af !important; } /* Empty state text */
        .light-mode .text-emerald-400 { color: #059669 !important; } /* IP text */
        .light-mode .text-blue-300 { color: #2563eb !important; } /* Port text */
        .light-mode .text-red-400 { color: #b91c1c !important; } /* Error text */
        .light-mode .placeholder-gray-700::placeholder { color: #a1a1aa !important; } /* Placeholder in textarea */
        
        /* Table/Code area colors */
        .light-mode .bg-gray-950 { background-color: #f9fafb !important; } /* Main background on table (for scroll) */
        .light-mode .bg-gray-800 { background-color: #f3f4f6 !important; } /* Table Header / Alternate row */
        .light-mode .bg-gray-900.alt-row { background-color: #ffffff !important; } /* Table alternate row override */
        .light-mode .hover\:bg-gray-700:hover { background-color: #e5e7eb !important; } /* Table row hover */
        .light-mode .text-gray-300 { color: #374151 !important; } /* Table cell text */

        /* Button colors (Copy buttons and others using gray-700/600) */
        .light-mode .bg-gray-700 { background-color: #e5e7eb !important; color: #1f2937 !important; border-color: #d1d5db !important; }
        .light-mode .hover\:bg-gray-600:hover { background-color: #d1d5db !important; }
        /* Submit button doesn't need override as it uses emerald-600/500 */
        /* Focus ring (focus:ring-emerald-600) doesn't need override */

        /* Icon Toggle Management */
        #moon-icon { display: block; }
        #sun-icon { display: none; }
        .light-mode #moon-icon { display: none; }
        .light-mode #sun-icon { display: block; }

    </style>
</head>
<body class="bg-gray-950 text-gray-200 font-sans min-h-screen flex flex-col">

    <script>
        let parsedResults = []; 

        function copyToClipboard(text, btnId) {
            const btn = document.getElementById(btnId);
            
            // 1. Copy text
            const el = document.createElement('textarea');
            el.value = text;
            document.body.appendChild(el);
            el.select();
            document.execCommand('copy');
            document.body.removeChild(el);

            // 2. Provide feedback
            const originalText = btn.innerText;
            
            btn.innerText = "Copied!";
            btn.classList.replace('bg-gray-700', 'bg-emerald-700');
            btn.classList.replace('hover:bg-gray-600', 'hover:bg-emerald-600'); 
            btn.classList.add('pointer-events-none'); // Prevent multiple clicks

            setTimeout(() => {
                btn.innerText = originalText;
                // Revert color, the light-mode CSS rules will take effect if needed
                btn.classList.replace('bg-emerald-700', 'bg-gray-700');
                btn.classList.replace('hover:bg-emerald-600', 'hover:bg-gray-600');
                btn.classList.remove('pointer-events-none');
            }, 2000);
        }

        // Theme Toggle Functions
        function toggleTheme() {
            const body = document.body;
            // The class toggle now controls the full-page theme via the global CSS overrides
            const isLightMode = body.classList.toggle('light-mode');
            
            // Save preference to localStorage
            localStorage.setItem('theme', isLightMode ? 'light' : 'dark');
        }

        function loadTheme() {
            const savedTheme = localStorage.getItem('theme') || 'dark'; // Default to dark
            const body = document.body;
            
            if (savedTheme === 'light') {
                body.classList.add('light-mode');
            } else {
                body.classList.remove('light-mode');
            }
        }

        // Initial theme load
        window.onload = function() {
            loadTheme();
            // Attach parseNmap to the button only after load
            document.querySelector('.w-full.py-3').onclick = parseNmap;
        };

        function clearInput() {
            document.getElementById('nmapInput').value = '';
            document.getElementById('nmapInput').focus();
        }

        function parseNmap() {
            const input = document.getElementById('nmapInput').value;
            const container = document.getElementById('resultsContainer');
            const resultCount = document.getElementById('resultCount');
            
            const copyButtons = ['copyAllBtn', 'copyVersionsBtn', 'copyGroupedBtn'];
            copyButtons.forEach(id => document.getElementById(id).classList.add('hidden'));

            if (!input.trim()) {
                container.innerHTML = `
                    <div class="flex flex-col items-center justify-center h-full text-red-400 space-y-2">
                        <svg class="w-12 h-12 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        <span class="text-sm">Please paste Nmap output first.</span>
                    </div>
                `;
                resultCount.innerText = "Error: No input.";
                return;
            }

            const lines = input.split('\n');
            let currentIp = null;
            let hasReasonColumn = false;
            let results = [];

            // Regex for finding IP address in Nmap header
            const ipRegex = /Nmap scan report for (?:[\w.-]+ \()?([\d.]+)\)?/;
            
            // Regex 1: Standard Output (PORT STATE SERVICE VERSION)
            const standardRegex = /^(\d+\/(?:tcp|udp|sctp))\s+(\w+)\s+(\S+)\s*(.*)?$/;

            // Regex 2: Output with Reason (PORT STATE SERVICE REASON VERSION)
            const reasonRegex = /^(\d+\/(?:tcp|udp|sctp))\s+(\w+)\s+(\S+)\s+\S+\s*(.*)?$/;

            lines.forEach(line => {
                const trimmedLine = line.trim();

                // Detect Header Line to check for REASON column
                if (trimmedLine.startsWith('PORT') && (trimmedLine.includes('STATE') || trimmedLine.includes('SERVICE'))) {
                    hasReasonColumn = trimmedLine.includes('REASON');
                    return;
                }

                // Check for IP header
                const ipMatch = trimmedLine.match(ipRegex);
                if (ipMatch) {
                    currentIp = ipMatch[1]; // The captured IP
                    return;
                }

                // If we have an active IP, check for ports
                if (currentIp) {
                    const activeRegex = hasReasonColumn ? reasonRegex : standardRegex;
                    const portMatch = trimmedLine.match(activeRegex);
                    
                    if (portMatch) {
                        const fullPort = portMatch[1];
                        const service = portMatch[3];
                        const version = portMatch[4] || "";

                        // Clean up version string
                        let cleanVersion = version.replace(/ttl\s*\d+/gi, '').trim();

                        // Skip if no actual version information was found
                        if (cleanVersion === "") {
                            return; 
                        }

                        const portNumber = parseInt(fullPort.split('/')[0]);

                        results.push({
                            ip: currentIp,
                            portStr: fullPort,
                            portNum: portNumber,
                            service: service,
                            version: cleanVersion,
                            displayVersion: cleanVersion
                        });
                    }
                }
            });

            // SORTING LOGIC
            results.sort((a, b) => {
                // IP Compare (numeric comparison for IP segments)
                const ipA = a.ip.split('.').map(Number);
                const ipB = b.ip.split('.').map(Number);
                
                for (let i = 0; i < 4; i++) {
                    if (ipA[i] < ipB[i]) return -1;
                    if (ipA[i] > ipB[i]) return 1;
                }

                // Port Compare
                return a.portNum - b.portNum;
            });
            
            // Store results globally for copy functions
            parsedResults = results;

            // RENDER RESULTS
            container.innerHTML = '';
            
            if (results.length === 0) {
                container.innerHTML = `
                    <div class="flex flex-col items-center justify-center h-full text-gray-600 space-y-2">
                        <svg class="w-12 h-12 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        <span class="text-sm text-red-400">No ports with identified version information found.</span>
                    </div>
                `;
                resultCount.innerText = "No results found.";
                return;
            }

            let html = '';
            results.forEach((r, index) => {
                // Use a dedicated class for one of the alternating rows that needs an override
                const bgClass = index % 2 === 0 ? 'bg-gray-900 alt-row' : 'bg-gray-800'; 
                html += `
                    <div class="grid grid-cols-12 ${bgClass} hover:bg-gray-700 text-sm border-b border-gray-800 transition-colors">
                        <div class="col-span-3 p-3 font-mono text-emerald-400 border-r border-gray-800 truncate" title="${r.ip}">${r.ip}</div>
                        <div class="col-span-2 p-3 font-mono text-blue-300 text-center border-r border-gray-800">${r.portStr}</div>
                        <div class="col-span-7 p-3 text-gray-300 truncate" title="${r.displayVersion}">${r.displayVersion}</div>
                    </div>
                `;
            });

            container.innerHTML = html;
            resultCount.innerText = `${results.length} identified versions found across hosts`;
            copyButtons.forEach(id => document.getElementById(id).classList.remove('hidden'));
        }

        // 1. Copies the full IP, PORT, and VERSION table (tab-separated)
        function copyAll() {
            if (parsedResults.length === 0) return;

            let clipboardText = "IP Address\tPort\tVersion\n";

            parsedResults.forEach(r => {
                clipboardText += `${r.ip}\t${r.portStr}\t${r.displayVersion}\n`;
            });

            copyToClipboard(clipboardText, 'copyAllBtn');
        }
        
        // 2. Copies only unique versions (newline-separated with bullet point)
        function copyUniqueVersions() {
            if (parsedResults.length === 0) return;

            // Use a Set to automatically handle deduplication
            const uniqueVersions = new Set(parsedResults.map(r => r.displayVersion));
            
            // Format each version string with a bullet point and join with newlines
            const clipboardText = Array.from(uniqueVersions)
                                   .map(version => `• ${version}`)
                                   .join('\n'); // Prepend with bullet and non-breaking space

            copyToClipboard(clipboardText, 'copyVersionsBtn');
        }

        // 3. Copies IP and Ports, grouped by IP (IP:port1,port2...)
        function copyGroupedIpPorts() {
            if (parsedResults.length === 0) return;

            const groupedMap = parsedResults.reduce((acc, current) => {
                // Ensure we only use the port number for the list (e.g., '22' instead of '22/tcp')
                const portNumber = current.portStr.split('/')[0];
                if (!acc[current.ip]) {
                    acc[current.ip] = new Set();
                }
                acc[current.ip].add(portNumber);
                return acc;
            }, {});

            let clipboardText = '';
            
            // Format: IP:port1,port2,port3
            for (const ip in groupedMap) {
                // Convert Set of ports to a comma-separated string
                const ports = Array.from(groupedMap[ip]).join(',');
                clipboardText += `${ip}:${ports}\n`;
            }

            copyToClipboard(clipboardText.trim(), 'copyGroupedBtn');
        }

    </script>

    <nav class="bg-gray-900 border-b border-gray-800 p-4 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto flex items-center justify-between">
            <div class="flex items-center space-x-3">
                <svg class="w-6 h-6 text-emerald-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                <span class="text-xl font-bold text-white tracking-tight">Nmap Result Parser</span>
                <p class="text-[12px] text-slate-600 dark:text-slate-500 font-medium uppercase tracking-wide">Sorting tool for Version Disclosure.</p>
            </div>
            
            <div class="flex items-center space-x-2">
                <button 
                    onclick="toggleTheme()" 
                    aria-label="Toggle theme"
                    class="p-2 rounded-full text-yellow-400 bg-gray-800 hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-emerald-500 transition-colors border border-gray-700">
                    
                    <svg id="moon-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5">
                        <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/>
                    </svg>

                    <svg id="sun-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5">
                        <circle cx="12" cy="12" r="4"/>
                        <path d="M12 2v2"/>
                        <path d="M12 20v2"/>
                        <path d="m4.93 4.93 1.41 1.41"/>
                        <path d="m17.66 17.66 1.41 1.41"/>
                        <path d="M2 12h2"/>
                        <path d="M20 12h2"/>
                        <path d="m6.34 17.66-1.41 1.41"/>
                        <path d="m19.07 4.93-1.41 1.41"/>
                    </svg>
                </button>
                <div class="text-xs text-gray-500 font-mono hidden sm:block">
                    Extracts: IP • PORT • VERSION
                </div>
            </div>
        </div>
    </nav>

    <main class="flex-grow container mx-auto px-4 py-8 max-w-7xl">
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 h-full">
            
            <div class="flex flex-col space-y-4">
                <div class="flex justify-between items-end">
                    <div>
                        <h2 class="text-lg font-semibold text-white">Input Scan Result</h2>
                        <p class="text-sm text-gray-400">Paste raw nmap output here (e.g. <code>nmap -sV 192.168.1.1</code>)</p>
                    </div>
                    <button onclick="clearInput()" class="text-xs text-red-400 hover:text-red-300 underline">Clear</button>
                </div>
                
                <textarea id="nmapInput" 
                    class="w-full h-96 lg:h-[calc(100vh-250px)] bg-gray-900 border border-gray-700 rounded-lg p-4 font-mono text-xs sm:text-sm text-green-400 focus:outline-none focus:ring-2 focus:ring-emerald-600 resize-none shadow-inner placeholder-gray-700"
                    placeholder="Starting Nmap 7.80 ...
Nmap scan report for 192.168.1.10
Host is up (0.0020s latency).
Not shown: 998 closed ports
PORT    STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3
80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))
443/tcp open ssl/http nginx 1.10.3 (Ubuntu)
..."></textarea>
                
                <button onclick="parseNmap()" 
                    class="w-full py-3 bg-emerald-600 hover:bg-emerald-500 text-white font-semibold rounded-lg shadow-lg transition-all transform hover:scale-[1.01] active:scale-95 flex justify-center items-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path></svg>
                    Extract & Sort Info
                </button>
            </div>

            <div class="flex flex-col space-y-4">
                <div class="flex justify-between items-center h-[52px]">
                    <div>
                        <h2 class="text-lg font-semibold text-white">Parsed Results</h2>
                        <p class="text-sm text-gray-400" id="resultCount">Waiting for input...</p>
                    </div>
                </div>

                <div class="flex space-x-2">
                    <button onclick="copyAll()" id="copyAllBtn" class="hidden px-3 py-1 bg-gray-700 hover:bg-gray-600 text-white text-xs rounded border border-gray-600 transition-colors whitespace-nowrap">
                        Copy All (Table)
                    </button>
                    <button onclick="copyUniqueVersions()" id="copyVersionsBtn" class="hidden px-3 py-1 bg-gray-700 hover:bg-gray-600 text-white text-xs rounded border border-gray-600 transition-colors whitespace-nowrap">
                        Copy Unique Versions
                    </button>
                    <button onclick="copyGroupedIpPorts()" id="copyGroupedBtn" class="hidden px-3 py-1 bg-gray-700 hover:bg-gray-600 text-white text-xs rounded border border-gray-600 transition-colors whitespace-nowrap">
                        Copy Grouped IP:Ports
                    </button>
                </div>
                
                <div class="relative w-full h-96 lg:h-[calc(100vh-250px)] bg-gray-900 border border-gray-700 rounded-lg overflow-hidden shadow-inner flex flex-col">
                    
                    <div class="grid grid-cols-12 bg-gray-800 text-gray-300 text-xs font-bold uppercase tracking-wider border-b border-gray-700 sticky top-0">
                        <div class="col-span-3 p-3 border-r border-gray-700">IP Address</div>
                        <div class="col-span-2 p-3 border-r border-gray-700 text-center">Port</div>
                        <div class="col-span-7 p-3">Version</div>
                    </div>

                    <div class="overflow-y-auto flex-grow" id="resultsContainer">
                        <div class="flex flex-col items-center justify-center h-full text-gray-600 space-y-2">
                            <svg class="w-12 h-12 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path></svg>
                            <span class="text-sm">Results will appear here</span>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <footer class="border-t border-gray-800 py-4 text-center text-xs text-gray-600">
        Nmap Output Parser v1.0
    </footer>

</body>
</html>

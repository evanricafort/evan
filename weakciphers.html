<!DOCTYPE html>
<html lang="en" class="">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weak SSL Cipher/Protocol Analyzer</title>
    <link href="profile.jpg" type="image/gif" rel="shortcut icon" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <style>
        .sun-icon, .moon-icon {
            transition: opacity 0.3s;
        }
        html.dark .sun-icon { opacity: 0; }
        html:not(.dark) .moon-icon { opacity: 0; }
        
        .toggle-button svg {
            transition: transform 0.2s ease-in-out;
        }
        .toggle-button svg.rotate-90 {
            transform: rotate(90deg);
        }

        .custom-scrollbar::-webkit-scrollbar {
            height: 8px;
            width: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
        .dark .custom-scrollbar::-webkit-scrollbar-track {
            background: #1e293b;
        }
        .dark .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #475569;
        }

        .shield-icon {
            transition: transform 0.3s ease;
        }
        header:hover .shield-icon {
            transform: scale(1.1) rotate(10deg);
        }
    </style>
    <script>
        tailwind.config = {
            darkMode: 'class', 
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'primary-indigo': '#4f46e5',
                        'primary-dark': '#1e293b',
                        'success-green': '#10b981',
                        'danger-red': '#ef4444',
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-800 dark:text-gray-200 font-sans transition-colors duration-300 p-6 md:p-10 min-h-screen flex flex-col items-center">

    <header class="w-full max-w-5xl relative mb-8 group">
        <div class="text-center">
            <h1 class="text-4xl md:text-5xl font-extrabold text-gray-800 dark:text-white mb-3 tracking-tight">
                <i class="fas fa-shield-alt mr-3 text-indigo-600 dark:text-indigo-500 shield-icon drop-shadow-md"></i>
                Weak SSL <span class="text-transparent bg-clip-text bg-gradient-to-r from-indigo-600 to-violet-500 dark:from-indigo-400 dark:to-violet-400">Cipher</span>
                Analyzer
            </h1>
            <p class="text-gray-500 dark:text-gray-400 text-lg">Analyze Weak SSL Cipher/Protocols from Nmap scan result.</p>
        </div>

        <button id="darkModeToggle" class="absolute top-0 right-0 p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition focus:outline-none" onclick="toggleDarkMode()">
            <div class="relative w-6 h-6">
                <svg class="sun-icon w-6 h-6 text-yellow-500 absolute inset-0" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.5-4.5l-1.591 1.591M3 12h2.25m.386-6.364l1.591 1.591M12 2.25a9.75 9.75 0 100 19.5 9.75 9.75 0 000-19.5z" />
                </svg>
                <svg class="moon-icon w-6 h-6 text-indigo-400 absolute inset-0" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M21.75 6.75v10.5a1.5 1.5 0 01-1.5 1.5h-15a1.5 1.5 0 01-1.5-1.5V6.75m19.5 0A.75.75 0 0021 6H3a.75.75 0 00-.75.75m19.5 0v.243a2.75 2.75 0 01-5.698 0l-.821 5.378a2.75 2.75 0 01-5.32 0l-.82-5.378A2.75 2.75 0 013.75 6.993V6.75M10.375 13.5l1.625-2.25 1.625 2.25M12 10.5a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0v-1.5a.75.75 0 01.75-.75z" />
                </svg>
            </div>
        </button>
    </header>

    <div class="w-full max-w-5xl bg-white dark:bg-gray-800 shadow-xl rounded-xl p-6 sm:p-8 mb-8 ring-1 ring-gray-100 dark:ring-gray-700 transition-colors duration-300">
        <h3 class="text-xl font-semibold text-gray-700 dark:text-gray-200 mb-4 border-b pb-2 border-gray-100 dark:border-gray-700">Input Data</h3>
        <textarea id="configInput" 
                  class="w-full h-40 p-4 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-indigo focus:border-primary-indigo dark:bg-gray-700 dark:text-gray-100 font-mono text-sm resize-y transition-colors duration-300 outline-none"
                  placeholder="Paste Nmap output (e.g. ssl-enum-ciphers) here..."></textarea>
        <div class="flex justify-end mt-4">
            <button class="px-6 py-2 font-semibold text-white bg-primary-indigo rounded-lg shadow-lg hover:bg-indigo-700 transition duration-200 ease-in-out transform hover:scale-[1.02]"
                    onclick="analyzeInput()">
                <i class="fas fa-search mr-2"></i> Analyze Data
            </button>
        </div>
    </div>

    <div class="w-full max-w-5xl bg-white dark:bg-gray-800 shadow-lg rounded-xl mb-8 overflow-hidden ring-1 ring-gray-100 dark:ring-gray-700">
        <button onclick="toggleDatabase()" class="w-full flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700/50 hover:bg-gray-100 dark:hover:bg-gray-700 transition text-left">
            <span class="font-bold text-primary-indigo dark:text-indigo-400"><i class="fas fa-database mr-2"></i> Algorithm Database</span>
            <i id="db-icon" class="fas fa-chevron-down text-gray-400 transition-transform duration-300" style="transform: rotate(180deg);"></i>
        </button>
        <div id="database-content" class="p-6 border-t border-gray-100 dark:border-gray-700">
            <input type="text" id="dbSearch" onkeyup="filterDatabase()" placeholder="Search database..." class="w-full p-2 mb-4 border border-gray-300 dark:border-gray-600 rounded bg-transparent dark:text-white focus:ring-1 focus:ring-primary-indigo">
            <div class="overflow-y-auto max-h-64 custom-scrollbar">
                <table class="w-full text-sm text-left">
                    <thead class="text-xs uppercase bg-gray-100 dark:bg-gray-900 text-gray-600 dark:text-gray-400 sticky top-0">
                        <tr>
                            <th class="px-4 py-2">Algorithm</th>
                            <th class="px-4 py-2">Type</th>
                            <th class="px-4 py-2">Description</th>
                        </tr>
                    </thead>
                    <tbody id="databaseTable" class="divide-y divide-gray-200 dark:divide-gray-700"></tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="resultsArea" class="w-full max-w-5xl hidden">
        
        <div class="bg-white dark:bg-gray-800 shadow-xl rounded-xl p-6 sm:p-8 ring-1 ring-gray-100 dark:ring-gray-700 transition-colors duration-300">
            <div class="flex justify-between items-end mb-4 border-b pb-2 border-gray-100 dark:border-gray-700">
                <h3 class="text-xl font-semibold text-gray-700 dark:text-gray-200">Analysis Report</h3>
                <div class="text-right">
                    <span class="text-sm text-gray-500 dark:text-gray-400">Issues Found:</span>
                    <span id="issueCount" class="text-lg font-bold text-danger-red ml-1">0</span>
                </div>
            </div>
            <p id="statusMessage" class="mb-4 text-sm italic"></p>

            <div class="flex flex-wrap gap-3 mb-6">
                <button onclick="copyResults(false)" class="px-4 py-2 rounded-lg bg-indigo-100 dark:bg-indigo-900/50 hover:bg-indigo-200 dark:hover:bg-indigo-900 text-indigo-800 dark:text-indigo-200 transition shadow-sm text-sm font-medium">
                    <i class="fas fa-list-ul mr-2"></i>Copy Grouped Summary
                </button>
                <button onclick="copyResults(true)" class="px-4 py-2 rounded-lg bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-200 transition shadow-sm text-sm font-medium">
                    <i class="fas fa-file-csv mr-2"></i>Copy Full Result
                </button>
                <button onclick="copyIPsOnly()" class="px-4 py-2 rounded-lg bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-200 transition shadow-sm text-sm font-medium">
                    <i class="fas fa-server mr-2"></i>Copy IPs Only
                </button>
                <button onclick="exportCSV()" class="px-4 py-2 rounded-lg bg-success-green hover:bg-emerald-600 text-white transition shadow-md text-sm font-medium ml-auto">
                    <i class="fas fa-download mr-2"></i>Export CSV
                </button>
            </div>

            <div class="overflow-x-auto custom-scrollbar rounded-lg border border-gray-200 dark:border-gray-700">
                <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                    <thead class="bg-indigo-50 dark:bg-gray-900">
                        <tr>
                            <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-indigo-800 dark:text-indigo-300 uppercase tracking-wider w-1/12">IP/Host</th>
                            <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-indigo-800 dark:text-indigo-300 uppercase tracking-wider w-3/12">Issue</th>
                            <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-indigo-800 dark:text-indigo-300 uppercase tracking-wider w-1/12">Status</th>
                            <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-indigo-800 dark:text-indigo-300 uppercase tracking-wider w-4/12">Details</th>
                            <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-indigo-800 dark:text-indigo-300 uppercase tracking-wider w-3/12">Fix</th>
                        </tr>
                    </thead>
                    <tbody id="resultsTable" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700 text-sm"></tbody>
                </table>
            </div>

            <div id="pagination" class="flex justify-center gap-2 mt-6"></div>

        </div>
    </div>

    <script>
        function toggleDarkMode() {
            const html = document.documentElement;
            if (html.classList.contains('dark')) {
                html.classList.remove('dark');
                localStorage.setItem('theme', 'light');
            } else {
                html.classList.add('dark');
                localStorage.setItem('theme', 'dark');
            }
        }
        if (localStorage.getItem('theme') === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        }

        const vulnerabilityDatabase = [
            { name: "EXP", type: "Weak Cipher/Key", explanation: "Export-grade cipher suites use weak encryption intended for outdated U.S. export laws.", fix: "Disable export ciphers." },
            { name: "DES", type: "Weak Cipher/Key", explanation: "Obsolete/insecure block cipher.", fix: "Replace with AES." },
            { name: "3DES", type: "Weak Cipher/Key", explanation: "Deprecated/vulnerable to SWEET32 (64-bit block).", fix: "Use AES-128/256 GCM." },
            { name: "RC4", type: "Weak Cipher/Key", explanation: "Stream cipher with biases, deprecated.", fix: "Remove RC4." },
            { name: "MD5", type: "Weak Hash", explanation: "Vulnerable to collisions.", fix: "Use SHA-256." },
            { name: "SHA1", type: "Weak Hash", explanation: "Vulnerable to collision attacks.", fix: "Replace with SHA-256." },
            { name: "CBC", type: "Weak Block Mode", explanation: "Prone to padding oracle (Lucky13).", fix: "Use GCM or CCM." },
            { name: "SSLv2", type: "Weak Protocol", explanation: "Obsolete/Insecure (DROWN).", fix: "Disable SSLv2." },
            { name: "SSLv3", type: "Weak Protocol", explanation: "Vulnerable to POODLE.", fix: "Disable SSLv3." },
            { name: "TLSv1.0", type: "Weak Protocol", explanation: "Deprecated/Insecure.", fix: "Use TLS 1.2 or 1.3." },
            { name: "TLSv1.1", type: "Weak Protocol", explanation: "Obsolete.", fix: "Use TLS 1.2 or 1.3." },
            { name: "FREAK", type: "Weak Cipher/Key", explanation: "Vulnerable to downgrade attacks.", fix: "Disable FREAK suites." },
            { name: "RC2", type: "Weak Cipher/Key", explanation: "Old cipher with known vulnerabilities.", fix: "Disable RC2." },
            { name: "ARIA", type: "Weak Cipher/Key", explanation: "Rarely used, insufficient analysis.", fix: "Prefer AES-GCM." },
            { name: "SRP", type: "Authentication", explanation: "Rarely supported, can weaken security.", fix: "Avoid TLS-SRP." },
            { name: "GOST", type: "Weak Cipher/Key", explanation: "Regional cipher, not widely accepted.", fix: "Use AES or ChaCha20." },
            { name: "PSK", type: "Authentication", explanation: "Pre-Shared Key is less secure for public services.", fix: "Use PKI." },
            { name: "ANON", type: "Authentication", explanation: "No authentication.", fix: "Avoid ADH/Anonymous suites." },
            { name: "RSA_EXPORT", type: "Weak Cipher/Key", explanation: "Weak keys, deprecated.", fix: "Disable export suites." },
            { name: "KRB5", type: "Authentication", explanation: "Rare/misconfigured.", fix: "Use standard TLS." }
        ];

        const ipIssuesMap = new Map();
        const itemsPerPage = 5;
        let currentPage = 1;

        function analyzeInput() {
            const input = document.getElementById("configInput").value.trim();
            const resultsArea = document.getElementById("resultsArea");
            const statusMessage = document.getElementById("statusMessage");
            const issueCountSpan = document.getElementById("issueCount");
            
            ipIssuesMap.clear();
            currentPage = 1;
            issueCountSpan.textContent = "0";
            document.getElementById("resultsTable").innerHTML = "";
            
            if (!input) {
                alert("Please Nmap SSL scan output to analyze.");
                return;
            }

            resultsArea.classList.remove("hidden");

            let currentIP = "";
            const rsaPattern = /RSA\s*\((\d+)\s*bit\)/;
            const exclusionString = "64-bit block cipher 3DES vulnerable to SWEET32 attack".toLowerCase();
            let totalIssues = 0;

            const lines = input.split("\n");
            
            lines.forEach(line => {
                const ipMatch = line.match(/Nmap scan report for ([^\s]+)/i);
                if (ipMatch) currentIP = ipMatch[1];
                if (!currentIP) return;
                
                if (line.toLowerCase().includes(exclusionString)) return;

                if (!ipIssuesMap.has(currentIP)) ipIssuesMap.set(currentIP, []);

                for (const item of vulnerabilityDatabase) {
                    if (line.includes(item.name)) {
                        const issueObj = {
                            category: item.type,
                            vulnerableAlgo: item.name,
                            output: line.trim().replace(/^\|\s*/, ''),
                            status: "WEAK",
                            explanation: item.explanation,
                            fix: item.fix
                        };
                        
                        const key = issueObj.output;
                        if (!ipIssuesMap.get(currentIP).some(i => i.output === key)) {
                            ipIssuesMap.get(currentIP).push(issueObj);
                            totalIssues++;
                        }
                    }
                }

                const rsaMatch = line.match(rsaPattern);
                if (rsaMatch && parseInt(rsaMatch[1]) < 2048) {
                    const issueObj = {
                        category: "Insecure RSA Key",
                        vulnerableAlgo: `RSA Key ${rsaMatch[1]} bit`,
                        output: `RSA Key: ${rsaMatch[1]} bits`,
                        status: "WEAK",
                        explanation: "Key < 2048 bits.",
                        fix: "Use >= 2048-bit key."
                    };
                    if (!ipIssuesMap.get(currentIP).some(i => i.category === issueObj.category)) {
                        ipIssuesMap.get(currentIP).push(issueObj);
                        totalIssues++;
                    }
                }
            });

            issueCountSpan.textContent = totalIssues;
            
            if (totalIssues > 0) {
                statusMessage.textContent = "Vulnerabilities detected. Review the table below.";
                statusMessage.className = "mb-4 text-sm font-medium text-danger-red";
            } else {
                statusMessage.textContent = "No obvious weak ciphers/protocols found in provided text.";
                statusMessage.className = "mb-4 text-sm font-medium text-success-green";
            }

            renderTable();
            resultsArea.scrollIntoView({ behavior: "smooth" });
        }

        function renderTable() {
            const table = document.getElementById("resultsTable");
            table.innerHTML = "";

            const allIPs = [...ipIssuesMap.keys()].filter(ip => ipIssuesMap.get(ip).length > 0);
            const pagedIPs = allIPs.slice((currentPage - 1) * itemsPerPage, currentPage * itemsPerPage);

            pagedIPs.forEach(ip => {
                const issues = ipIssuesMap.get(ip);
                const count = issues.length;
                if (count === 0) return;

                issues.forEach((issue, index) => {
                    const row = table.insertRow();
                    row.className = "hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors";

                    if (index === 0) {
                        const cellIP = row.insertCell(0);
                        cellIP.rowSpan = count;
                        cellIP.className = "px-4 py-3 whitespace-nowrap text-sm font-bold text-primary-indigo dark:text-indigo-400 align-top bg-gray-50 dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700";
                        cellIP.textContent = ip;
                    }

                    const cellIssue = row.insertCell(-1);
                    cellIssue.className = "px-4 py-3 text-sm font-mono text-gray-700 dark:text-gray-300 align-top";
                    cellIssue.textContent = issue.output;

                    const cellStatus = row.insertCell(-1);
                    cellStatus.className = "px-4 py-3 text-sm align-top";
                    cellStatus.innerHTML = `<span class="px-2 py-1 text-xs font-bold rounded bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200">${issue.status}</span>`;

                    const cellDesc = row.insertCell(-1);
                    cellDesc.className = "px-4 py-3 text-sm text-gray-600 dark:text-gray-400 align-top";
                    cellDesc.textContent = issue.explanation;

                    const cellFix = row.insertCell(-1);
                    cellFix.className = "px-4 py-3 text-sm italic text-gray-500 dark:text-gray-500 align-top";
                    cellFix.textContent = issue.fix;
                });
            });

            renderPagination(allIPs.length);
        }

        function renderPagination(totalIPs) {
            const pagination = document.getElementById("pagination");
            pagination.innerHTML = "";
            const totalPages = Math.ceil(totalIPs / itemsPerPage);

            if (totalPages <= 1) return;

            for (let i = 1; i <= totalPages; i++) {
                const btn = document.createElement("button");
                btn.textContent = i;
                btn.onclick = () => { currentPage = i; renderTable(); };
                
                let classes = "px-3 py-1 rounded text-sm font-semibold transition ";
                if (i === currentPage) {
                    classes += "bg-primary-indigo text-white shadow-md";
                } else {
                    classes += "bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600";
                }
                btn.className = classes;
                pagination.appendChild(btn);
            }
        }

        function toggleDatabase() {
            const content = document.getElementById("database-content");
            const icon = document.getElementById("db-icon");
            content.classList.toggle("hidden");
            icon.style.transform = content.classList.contains("hidden") ? "rotate(0deg)" : "rotate(180deg)";
        }

        function renderDatabaseRows(data) {
            const tbody = document.getElementById("databaseTable");
            tbody.innerHTML = "";
            if (data.length === 0) {
                tbody.innerHTML = `<tr><td colspan="3" class="px-4 py-2 text-center italic text-gray-500">No matching algorithms.</td></tr>`;
                return;
            }
            data.forEach(item => {
                const row = `
                    <tr class="hover:bg-gray-50 dark:hover:bg-gray-700/50">
                        <td class="px-4 py-2 font-medium text-gray-800 dark:text-gray-200">${item.name}</td>
                        <td class="px-4 py-2 text-xs text-gray-500 dark:text-gray-400 uppercase">${item.type}</td>
                        <td class="px-4 py-2 text-gray-600 dark:text-gray-400">${item.explanation}</td>
                    </tr>`;
                tbody.insertAdjacentHTML('beforeend', row);
            });
        }

        function filterDatabase() {
            const term = document.getElementById("dbSearch").value.toLowerCase();
            const filtered = vulnerabilityDatabase.filter(i => 
                i.name.toLowerCase().includes(term) || 
                i.type.toLowerCase().includes(term) || 
                i.explanation.toLowerCase().includes(term)
            );
            renderDatabaseRows(filtered);
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            renderDatabaseRows(vulnerabilityDatabase);
        });

        function copyResults(isFullCSV) {
            let text = "";
            if (isFullCSV) {
                text = "IP,Issue,Description,Fix\n";
                const unique = new Set();
                ipIssuesMap.forEach((issues, ip) => {
                    issues.forEach(i => {
                        const key = `${ip}|${i.output}`;
                        if (!unique.has(key)) {
                            unique.add(key);
                            text += `${ip},"${i.output.replace(/"/g, '""')}","${i.explanation}","${i.fix}"\n`;
                        }
                    });
                });
            } else {
                text = "IP/HOST - STATUS - ISSUES (Weak Ciphers & Protocols)\n";
                ipIssuesMap.forEach((issues, ip) => {
                    if (issues.length === 0) return;
                    const list = issues.map(i => i.output).join(", ");
                    text += `${ip} - WEAK - ${list}\n`;
                });
            }

            if (text.split("\n").length > 1) {
                navigator.clipboard.writeText(text).then(() => alert("Copied to clipboard!"));
            } else {
                alert("No findings to copy.");
            }
        }

        function copyIPsOnly() {
            const ips = [...ipIssuesMap.keys()].filter(ip => ipIssuesMap.get(ip).length > 0);
            if (ips.length > 0) {
                navigator.clipboard.writeText(ips.join("\n")).then(() => alert("IPs copied!"));
            } else {
                alert("No IPs with findings.");
            }
        }

        function exportCSV() {
            let csv = "IP,Issue,Description,Fix\n";
            const unique = new Set();
            ipIssuesMap.forEach((issues, ip) => {
                issues.forEach(i => {
                    const key = `${ip}|${i.output}`;
                    if (!unique.has(key)) {
                        unique.add(key);
                        csv += `${ip},"${i.output.replace(/"/g, '""')}","${i.explanation}","${i.fix}"\n`;
                    }
                });
            });

            if (unique.size > 0) {
                const link = document.createElement("a");
                link.href = "data:text/csv;charset=utf-8," + encodeURIComponent(csv);
                link.download = "scan_report.csv";
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            } else {
                alert("Nothing to export.");
            }
        }
    </script>
</body>
</html>

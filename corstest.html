<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CORS Misconfiguration Scanner</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f5f5f5;
            color: black;
            transition: background-color 0.3s, color 0.3s;
        }
        body.dark-mode {
            background-color: #2c2c2c;
            color: white;
        }
        .container {
            width: 500px;
            padding: 20px;
            background-color: #ffffff;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            transition: background-color 0.3s;
        }
        .container.dark-mode {
            background-color: #333;
        }
        h1 {
            text-align: center;
            margin-bottom: 20px;
        }
        label {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 8px;
            display: block;
        }
        input[type="text"], button {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            font-size: 14px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        input[type="text"]:focus {
            outline: none;
            border-color: #4CAF50;
        }
        button {
            background-color: #4CAF50;
            color: white;
            font-size: 16px;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            font-size: 16px;
            margin-bottom: 20px;
        }
        .vuln {
            background-color: #ff4d4d;
            color: white;
        }
        .warn {
            background-color: #ffcc00;
            color: black;
        }
        .ok {
            background-color: #4caf50;
            color: white;
        }
        .error {
            background-color: #f44336;
            color: white;
        }
        .noCORS {
            background-color: #f1f1f1;
            color: black;
        }
        .log-container {
            margin-top: 20px;
            background-color: #222;
            color: #fff;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
            height: 200px;
            overflow-y: auto;
        }
        .dark-mode .log-container {
            background-color: #444;
        }
        .toggle-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px;
            background-color: #333;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
    </style>
</head>
<body>

    <button class="toggle-btn" onclick="toggleDarkMode()">üåô Dark Mode</button>

    <div class="container">
        <h1>CORS Misconfiguration Scanner</h1>

        <label for="url">Target URL:</label>
        <input type="text" id="url" placeholder="Enter target URL" />

        <label for="origin">Origin URL:</label>
        <input type="text" id="origin" placeholder="Enter Origin URL (e.g., https://evil.com)" value="https://evil.com" />

        <label for="method">HTTP Method (GET, POST, etc.):</label>
        <input type="text" id="method" placeholder="Enter HTTP Method" value="GET" />

        <button onclick="startScan()">Start Scan</button>

        <div id="scanResult"></div>

        <div class="log-container" id="logContainer"></div>
    </div>

    <script>
        const log = (message) => {
            const logContainer = document.getElementById('logContainer');
            logContainer.textContent += message + '\n';
            logContainer.scrollTop = logContainer.scrollHeight;
        };

        const resultDetails = {
            vuln: {
                message: "üî¥ Vulnerable: Wildcard Origin or Exploitable CORS Misconfiguration",
                explanation: `
A vulnerable CORS configuration has been identified, meaning the target server:
- Allows all origins by setting 'Access-Control-Allow-Origin' to '*' (Wildcard), or
- Reflects the origin back and allows credentials, potentially allowing Cross-Site Request Forgery (CSRF) or allowing attackers to steal sensitive data (e.g., cookies) from authenticated users.

**Risk:**
- Attackers can exploit the wildcard origin configuration to make unauthorized requests or steal sensitive data from authenticated users.
- If a vulnerable API is exposed, it can allow unauthorized websites to access the data or act on behalf of the user.

**Recommendation:**
- Restrict CORS to a specific set of trusted origins (e.g., using 'Access-Control-Allow-Origin: https://yourtrustedorigin.com').
- Do not allow credentials (cookies, HTTP authentication, client-side certificates) from untrusted origins.
- Enforce stricter validation of allowed methods (e.g., only allow 'GET' and 'POST', avoid risky methods like 'DELETE' and 'PUT' unless necessary).
                `
            },
            warn: {
                message: "üü† Warning: Reflective Origin Detected, Credentials Not Allowed",
                explanation: `
A reflective origin has been detected, which indicates that the target server is echoing the origin back in the 'Access-Control-Allow-Origin' header. However, the response does not allow credentials (cookies, authentication tokens).

**Risk:**
- While credentials are not allowed, this reflective configuration may still enable attackers to spoof requests or launch social engineering attacks against users.
- The vulnerability is mitigated by disallowing credentials, but this setup can be exploited in certain scenarios where malicious scripts could gain unauthorized access.

**Recommendation:**
- Restrict the CORS policy to only trusted, specific origins.
- Consider setting 'Access-Control-Allow-Credentials' to 'false' explicitly to prevent any misuse of the credentials across origins.
- Audit any endpoints that may potentially allow cross-origin access to sensitive data without proper safeguards.
                `
            },
            ok: {
                message: "üü¢ Safe: Proper CORS Configuration Detected",
                explanation: `
The target server has implemented a proper CORS configuration, meaning it only accepts requests from trusted origins and either does not allow credentials or limits them to certain trusted sites.

**Risk:**
- No immediate risk. The server is properly secured against cross-origin attacks, reducing the likelihood of cross-origin data theft or unauthorized actions.
- This result indicates a well-configured CORS policy, protecting users from potential data leaks or abuse.

**Recommendation:**
- Continue enforcing a restrictive CORS policy.
- Periodically audit your CORS configuration to ensure that only necessary endpoints are exposed.
- Always restrict access to sensitive resources and consider additional security layers such as authentication and authorization checks.
                `
            },
            error: {
                message: "‚ùå Error: Scan Failed or Misconfigured",
                explanation: `
An error occurred during the scan, indicating one of the following:
- The URL is incorrect or unreachable.
- There was a misconfiguration in the CORS settings.
- A network issue prevented the scan from completing successfully.

**Risk:**
- The test could not be performed successfully, and no conclusions can be drawn from the scan result. This may require further investigation into the server's CORS configuration.

**Recommendation:**
- Verify the target URL and ensure it is reachable.
- Ensure that the server is configured to handle OPTIONS requests (preflight check) correctly.
- Investigate the server logs for any issues that might prevent the scan from completing.
                `
            },
            noCORS: {
                message: "‚ö™ No CORS Headers Found",
                explanation: `
The target endpoint did not return any CORS headers, which suggests that the server either does not support CORS or is deliberately blocking cross-origin requests.

**Risk:**
- This can be considered a good security measure for sensitive endpoints that should not be accessed cross-origin.
- However, if the endpoint is supposed to support cross-origin access (e.g., from a web client), the lack of CORS headers could indicate misconfiguration.

**Recommendation:**
- If the endpoint is meant to be accessed from a different origin (e.g., by a frontend web application), ensure the correct CORS headers are set.
- If no cross-origin access is required, verify that the security posture remains strong by using other access control measures.
                `
            }
        };

        async function startScan() {
            const url = document.getElementById('url').value;
            const origin = document.getElementById('origin').value;
            const method = document.getElementById('method').value;

            if (!url || !origin || !method) {
                alert("Please enter a URL, Origin, and HTTP Method.");
                return;
            }

            log(`Starting scan on ${url} with method ${method} and origin ${origin}`);
            const result = await checkCORS(url, origin, method);
            displayResult(result);
        }

        async function checkCORS(url, origin, method) {
            try {
                log(`\nüåê Scanning ${url} using ${method}`);
                const preflightHeaders = {
                    "Origin": origin,
                    "Access-Control-Request-Method": method
                };

                // Preflight OPTIONS
                log(`OPTIONS ${url}`);
                const optionsRes = await fetch(url, {
                    method: "OPTIONS",
                    headers: preflightHeaders
                });
                log(`OPTIONS Status: ${optionsRes.status}`);
                optionsRes.headers.forEach((v, k) => log(`  ${k}: ${v}`));

                // Actual request
                const actualRes = await fetch(url, {
                    method: method,
                    headers: {
                        "Origin": origin
                    },
                    mode: "cors",
                    body: ["POST", "PUT", "PATCH"].includes(method) ? "data=test" : undefined
                });

                const ao = actualRes.headers.get("Access-Control-Allow-Origin");
                const ac = actualRes.headers.get("Access-Control-Allow-Credentials");
                const status = actualRes.status;
                log(`\n${method} ${url}`);
                log(`Status: ${status}`);
                log(`Access-Control-Allow-Origin: ${ao}`);
                log(`Access-Control-Allow-Credentials: ${ac}`);

                let resultStatus, resultNotes;

                // Check for wildcard origin
                if (ao === "*") {
                    resultStatus = "vuln";
                    resultNotes = resultDetails.vuln.explanation;
                }
                // Check for allowed origin and credentials
                else if (ao === origin && ac === "true") {
                    resultStatus = "vuln";
                    resultNotes = resultDetails.vuln.explanation;
                } else if (ao === origin) {
                    resultStatus = "warn";
                    resultNotes = resultDetails.warn.explanation;
                } else if (ao) {
                    resultStatus = "ok";
                    resultNotes = resultDetails.ok.explanation;
                } else {
                    resultStatus = "noCORS";
                    resultNotes = resultDetails.noCORS.explanation;
                }

                return { status: resultStatus, notes: resultNotes };
            } catch (err) {
                log(`‚ùå Error: ${err.message}`);
                return {
                    status: "error",
                    notes: resultDetails.error.explanation
                };
            }
        }

        function displayResult(result) {
            const resultDiv = document.getElementById("scanResult");
            const statusClass = result.status;
            resultDiv.innerHTML = `
                <div class="result ${statusClass}">
                    <h3>${resultDetails[statusClass].message}</h3>
                    <p>${result.notes}</p>
                </div>
            `;
        }

        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            document.querySelector('.container').classList.toggle('dark-mode');
        }
    </script>

</body>
</html>

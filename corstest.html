<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CORS Misconfiguration Scanner (with Wildcard Check & Graphical Summary)</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: sans-serif;
      background: #f5f5f5;
      padding: 2rem;
    }
    textarea, input, select {
      width: 100%;
      padding: 0.6rem;
      margin-bottom: 1rem;
      font-size: 1rem;
    }
    button {
      padding: 0.6rem 1.2rem;
      font-weight: bold;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }
    th, td {
      padding: 8px;
      border: 1px solid #ccc;
      vertical-align: top;
    }
    #log {
      white-space: pre-wrap;
      background: #111;
      color: #0f0;
      padding: 1rem;
      font-family: monospace;
      max-height: 300px;
      overflow: auto;
    }
    .vuln { color: red; font-weight: bold; }
    .warn { color: orange; }
    .ok { color: green; }
    .error { color: gray; }
    #charts { margin-top: 2rem; }
  </style>
</head>
<body>

<h2>üõ°Ô∏è CORS Scanner (with Wildcard Check & Graphical Summary)</h2>

<label>Target URLs (one per line):</label>
<textarea id="urls" rows="5" placeholder="https://example.com"></textarea>

<label>Malicious Origin:</label>
<input type="text" id="origin" value="https://evil.com">

<label>Scan Type:</label>
<select id="scanType" onchange="toggleCustomMethod()">
  <option value="GET">GET</option>
  <option value="POST">POST</option>
  <option value="OTHER">OTHER (Custom Method)</option>
</select>

<div id="customMethodBox" style="display: none;">
  <label>Custom Method:</label>
  <input type="text" id="customMethod" placeholder="PUT, DELETE, PATCH...">
</div>

<label>Custom Headers (JSON - Optional):</label>
<textarea id="headers" rows="3" placeholder='{"X-Auth": "abc123"}'></textarea>

<label><input type="checkbox" id="withCreds"> Simulate Credentials (send cookies/session)</label><br>

<label>Discord Webhook (optional):</label>
<input type="text" id="webhook" placeholder="https://discord.com/api/webhooks/...">

<button onclick="startScan()">üöÄ Start Scan</button>

<table id="results">
  <thead>
    <tr>
      <th>URL</th>
      <th>Status</th>
      <th>Explanation</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<h3>üìÑ Detailed Logs:</h3>
<pre id="log">[Ready to scan]</pre>

<div id="charts">
  <h3>üìä Graphical Summary</h3>
  <canvas id="vulnChart"></canvas>
  <canvas id="headerChart"></canvas>
</div>

<script>
  let vulnData = { vuln: 0, warn: 0, safe: 0 };
  let headerData = { wildcard: 0, specific: 0, noCORS: 0 };

  function log(msg) {
    const el = document.getElementById("log");
    el.textContent += `\n${msg}`;
    el.scrollTop = el.scrollHeight;
  }

  function appendResult(url, status, notes) {
    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${url}</td>
      <td class="${status}">${status.toUpperCase()}</td>
      <td>${notes}</td>
    `;
    document.querySelector("#results tbody").appendChild(row);

    // Update graphical data
    if (status === 'vuln') vulnData.vuln++;
    else if (status === 'warn') vulnData.warn++;
    else vulnData.safe++;

    if (notes.includes("Wildcard origin")) headerData.wildcard++;
    else if (notes.includes("No CORS headers")) headerData.noCORS++;
    else headerData.specific++;

    updateCharts();
  }

  function updateCharts() {
    const vulnChartCtx = document.getElementById('vulnChart').getContext('2d');
    new Chart(vulnChartCtx, {
      type: 'bar',
      data: {
        labels: ['Vulnerable', 'Warning', 'Safe'],
        datasets: [{
          label: 'Scan Results',
          data: [vulnData.vuln, vulnData.warn, vulnData.safe],
          backgroundColor: ['red', 'orange', 'green'],
        }],
      },
    });

    const headerChartCtx = document.getElementById('headerChart').getContext('2d');
    new Chart(headerChartCtx, {
      type: 'pie',
      data: {
        labels: ['Wildcard Origins', 'Specific Origins', 'No CORS Headers'],
        datasets: [{
          data: [headerData.wildcard, headerData.specific, headerData.noCORS],
          backgroundColor: ['red', 'blue', 'gray'],
        }],
      },
    });
  }

  async function sendToDiscord(webhook, msg) {
    if (!webhook) return;
    try {
      await fetch(webhook, {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ content: msg })
      });
      log("üì§ Discord alert sent");
    } catch (e) {
      log("‚ùå Discord webhook failed");
    }
  }

  async function checkCORS(url, origin, method, headers = {}, withCreds = false) {
    try {
      log(`\nüåê Scanning ${url} using ${method} (credentials: ${withCreds})`);
      const preflightHeaders = {
        "Origin": origin,
        "Access-Control-Request-Method": method,
        ...headers
      };

      // Preflight OPTIONS
      log(`OPTIONS ${url}`);
      const optionsRes = await fetch(url, {
        method: "OPTIONS",
        headers: preflightHeaders
      });
      log(`OPTIONS Status: ${optionsRes.status}`);
      optionsRes.headers.forEach((v, k) => log(`  ${k}: ${v}`));

      // Actual request
      const actualRes = await fetch(url, {
        method: method,
        headers: {
          "Origin": origin,
          ...headers
        },
        mode: "cors",
        credentials: withCreds ? "include" : "omit",
        body: ["POST", "PUT", "PATCH"].includes(method) ? "data=test" : undefined
      });

      const ao = actualRes.headers.get("Access-Control-Allow-Origin");
      const ac = actualRes.headers.get("Access-Control-Allow-Credentials");
      const status = actualRes.status;
      log(`\n${method} ${url}`);
      log(`Status: ${status}`);
      log(`Access-Control-Allow-Origin: ${ao}`);
      log(`Access-Control-Allow-Credentials: ${ac}`);

      let resultStatus, resultNotes;

      // Check for wildcard origin
      if (ao === "*") {
        resultStatus = "vuln";
        resultNotes = `üî¥ Wildcard origin detected: CORS is open to all origins (unsafe). This is a security risk if credentials are allowed.`;
      }
      // Check for allowed origin and credentials
      else if (ao === origin && ac === "true" && withCreds) {
        resultStatus = "vuln";
        resultNotes = `üî¥ Full exploit possible: Malicious origin is reflected AND credentials accepted.
        Attackers can steal authenticated data cross-origin using cookies/session.`;
      } else if (ao === origin) {
        resultStatus = "warn";
        resultNotes = `üü† Warning: Origin reflected but credentials not allowed.
        Still risky if responses are exposed to JS or sensitive metadata is returned.`;
      } else if (ao) {
        resultStatus = "ok";
        resultNotes = `üü¢ Origin not reflected. CORS policy appears safe (explicit origin: ${ao}).`;
      } else {
        resultStatus = "ok";
        resultNotes = "üü¢ No CORS headers found. Server likely blocks cross-origin access.";
      }

      return { status: resultStatus, notes: resultNotes };
    } catch (err) {
      log(`‚ùå Error: ${err.message}`);
      return {
        status: "error",
        notes: `‚ùå Could not complete scan: ${err.message}`
      };
    }
  }

  async function startScan() {
    const urls = document.getElementById("urls").value.trim().split("\n").map(u => u.trim()).filter(Boolean);
    const origin = document.getElementById("origin").value.trim();
    const scanType = document.getElementById("scanType").value;
    const method = scanType === "OTHER" ? document.getElementById("customMethod").value.trim().toUpperCase() : scanType;
    const customHeadersInput = document.getElementById("headers").value.trim();
    const customHeaders = customHeadersInput ? parseHeaders(customHeadersInput) : {};
    const withCreds = document.getElementById("withCreds").checked; // Simulate credentials option
    const webhook = document.getElementById("webhook").value.trim();

    document.querySelector("#results tbody").innerHTML = "";
    document.getElementById("log").textContent = "[Starting scan...]";

    for (const url of urls) {
      appendResult(url, "...", "Scanning...");
      const result = await checkCORS(url, origin, method, customHeaders, withCreds);
      document.querySelector("#results tbody").lastChild.remove();
      appendResult(url, result.status, result.notes);

      if ((result.status === "vuln" || result.status === "warn") && webhook) {
        const msg = `üö® CORS Alert\n**URL:** ${url}\n**Status:** ${result.status}\n**Details:** ${result.notes}`;
        await sendToDiscord(webhook, msg);
      }
    }

    log("\n‚úÖ Scan complete.");
  }

  function parseHeaders(headers) {
    try {
      return JSON.parse(headers);
    } catch (e) {
      log(`‚ùå Invalid headers format`);
      return {};
    }
  }
</script>

</body>
</html>

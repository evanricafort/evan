<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPF Record Detector</title>
    <link href="profile.jpg" type="image/gif" rel="shortcut icon" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        gray: {
                            850: '#1f2937',
                            900: '#111827',
                            950: '#0b0f19',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        details > summary { list-style: none; }
        details > summary::-webkit-details-marker { display: none; }
        body, div, nav, button, input, table, th, td {
            transition-property: color, background-color, border-color, text-decoration-color, fill, stroke;
            transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
            transition-duration: 300ms;
        }

        select {
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            background-size: 1em;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 dark:bg-gray-950 dark:text-gray-200 min-h-screen flex flex-col items-center py-8 md:py-12 px-4 antialiased selection:bg-indigo-500 selection:text-white transition-colors duration-300">

    <div class="absolute top-4 right-4 md:top-8 md:right-8">
        <button onclick="toggleTheme()" class="p-3 rounded-full bg-white dark:bg-gray-800 text-gray-600 dark:text-yellow-400 shadow-lg border border-gray-200 dark:border-gray-700 hover:scale-105 transition-transform focus:outline-none focus:ring-2 focus:ring-indigo-500">
            <i id="themeIcon" class="fas fa-sun text-xl"></i>
        </button>
    </div>

    <main class="w-full max-w-3xl space-y-8 mt-8">
        
        <div class="text-center space-y-3">
            <h1 class="text-3xl md:text-5xl font-extrabold tracking-tight text-gray-900 dark:text-white flex items-center justify-center gap-3">
                <i class="fas fa-shield-halved text-indigo-600 dark:text-indigo-500"></i>
                <span><span class="text-indigo-600 dark:text-indigo-500">SPF</span> Detector</span>
            </h1>
            <p class="text-gray-600 dark:text-gray-400 text-sm md:text-lg max-w-xl mx-auto">
                Validate email security configurations and analyze Sender Policy Framework records.
            </p>
        </div>

        <div class="bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-800 rounded-2xl p-6 md:p-8 shadow-xl dark:shadow-black/50">
            <form id="spfForm" class="space-y-5" onsubmit="handleLookup(event)">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="md:col-span-2 space-y-2">
                        <label for="domainInput" class="block text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-widest">Target Domain</label>
                        <input type="text" id="domainInput" placeholder="e.g., google.com" class="block w-full px-4 py-4 bg-gray-50 dark:bg-gray-950 border border-gray-200 dark:border-gray-700 rounded-xl focus:ring-2 focus:ring-indigo-500 text-gray-900 dark:text-white font-mono text-lg" required>
                    </div>
                    <div class="space-y-2">
                        <label for="selectorInput" class="block text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-widest">DKIM Selector</label>
                        <select id="selectorInput" class="block w-full px-4 py-4 bg-gray-50 dark:bg-gray-950 border border-gray-200 dark:border-gray-700 rounded-xl focus:ring-2 focus:ring-indigo-500 text-gray-900 dark:text-white font-mono text-lg cursor-pointer">
                            <option value="selector1" selected>selector1</option>
                            <option value="default">default</option>
                            <option value="google">google</option>
                            <option value="selector2">selector2</option>
                            <option value="mail">mail</option>
                        </select>
                    </div>
                </div>
                <button type="submit" id="submitBtn" class="w-full flex justify-center items-center gap-2 py-4 px-6 rounded-xl shadow-lg text-sm font-bold text-white bg-gradient-to-r from-indigo-600 to-indigo-700 hover:from-indigo-500 hover:to-indigo-600 transition-all uppercase tracking-wide transform active:scale-[0.98]">
                    <span>Analyze Records</span>
                    <i class="fas fa-arrow-right"></i>
                </button>
            </form>
        </div>

        <div id="loading" class="hidden flex flex-col items-center justify-center space-y-4 py-8">
            <div class="animate-spin rounded-full h-12 w-12 border-4 border-gray-200 dark:border-gray-800 border-t-indigo-600 dark:border-t-indigo-500"></div>
            <p class="text-gray-500 dark:text-gray-400 font-mono text-sm">Querying DNS via Google Public DNS...</p>
        </div>

        <div id="results" class="hidden space-y-6">
            
            <div id="statusBanner" class="rounded-xl p-5 border-l-4 flex items-start gap-4 shadow-md bg-white dark:bg-gray-800/50">
                <div id="statusIcon" class="mt-1 flex-shrink-0"></div>
                <div>
                    <h3 id="statusTitle" class="font-bold text-lg text-gray-900 dark:text-white"></h3>
                    <p id="statusDesc" class="text-sm text-gray-600 dark:text-gray-300 mt-1"></p>
                </div>
            </div>

            <div class="grid grid-cols-1 gap-6">
                <div class="bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-800 rounded-xl overflow-hidden shadow-sm">
                    <div class="bg-gray-50 dark:bg-gray-850 px-5 py-3 border-b border-gray-200 dark:border-gray-800 flex justify-between items-center">
                        <span class="text-xs font-bold font-mono text-gray-500 dark:text-gray-400 uppercase tracking-wider">SPF (TXT)</span>
                        <button onclick="copyToClipboard('spfRaw')" class="text-gray-500 hover:text-indigo-600 dark:hover:text-white transition-colors text-xs uppercase font-bold tracking-wider flex items-center gap-2">
                            <i class="far fa-copy"></i> Copy
                        </button>
                    </div>
                    <div class="p-5 bg-white dark:bg-[#0d1117]">
                        <code id="spfRaw" class="font-mono text-indigo-600 dark:text-indigo-300 text-sm whitespace-pre-wrap break-all"></code>
                    </div>
                </div>

                <div class="bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-800 rounded-xl overflow-hidden shadow-sm">
                    <div class="bg-gray-50 dark:bg-gray-850 px-5 py-3 border-b border-gray-200 dark:border-gray-800 flex justify-between items-center">
                        <span class="text-xs font-bold font-mono text-gray-500 dark:text-gray-400 uppercase tracking-wider">DMARC (_dmarc)</span>
                        <div id="dmarcStatusBadge"></div>
                    </div>
                    <div class="p-5 bg-white dark:bg-[#0d1117]">
                        <code id="dmarcRaw" class="font-mono text-indigo-600 dark:text-indigo-300 text-sm whitespace-pre-wrap break-all"></code>
                    </div>
                </div>

                <div class="bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-800 rounded-xl overflow-hidden shadow-sm">
                    <div class="bg-gray-50 dark:bg-gray-850 px-5 py-3 border-b border-gray-200 dark:border-gray-800 flex justify-between items-center">
                        <span class="text-xs font-bold font-mono text-gray-500 dark:text-gray-400 uppercase tracking-wider">DKIM (_domainkey)</span>
                        <div id="dkimStatusBadge"></div>
                    </div>
                    <div class="p-5 bg-white dark:bg-[#0d1117]">
                        <code id="dkimRaw" class="font-mono text-indigo-600 dark:text-indigo-300 text-sm whitespace-pre-wrap break-all"></code>
                    </div>
                </div>
            </div>

            <div id="breakdownContainer" class="hidden bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-800 rounded-xl p-6 shadow-sm">
                <h3 class="text-gray-900 dark:text-white font-bold mb-5 flex items-center gap-2 text-lg">
                    <i class="fas fa-list-ul text-indigo-500"></i> SPF Record Breakdown
                </h3>
                <div class="overflow-x-auto rounded-lg border border-gray-200 dark:border-gray-800">
                    <table class="w-full text-left text-sm">
                        <thead class="bg-gray-50 dark:bg-gray-850 text-gray-500 dark:text-gray-400 font-mono uppercase text-xs tracking-wider">
                            <tr>
                                <th class="px-5 py-4 font-semibold">Status</th>
                                <th class="px-5 py-4 font-semibold">Mechanism</th>
                                <th class="px-5 py-4 font-semibold">Value</th>
                                <th class="px-5 py-4 font-semibold">Description</th>
                            </tr>
                        </thead>
                        <tbody id="breakdownBody" class="divide-y divide-gray-200 dark:divide-gray-800 font-mono bg-white dark:bg-gray-900 text-gray-700 dark:text-gray-300"></tbody>
                    </table>
                </div>
            </div>

            <details class="group bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-800 rounded-xl overflow-hidden shadow-sm">
                <summary class="flex justify-between items-center p-4 cursor-pointer bg-gray-50 dark:bg-gray-850 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors">
                    <span class="text-sm font-mono text-gray-500 dark:text-gray-400 uppercase font-bold flex items-center gap-2">
                        <i class="fas fa-code"></i> Consolidated Raw Response Log
                    </span>
                    <i class="fas fa-chevron-down text-gray-400 group-open:rotate-180 transition-transform"></i>
                </summary>
                <div class="p-4 bg-gray-50 dark:bg-black/30 border-t border-gray-200 dark:border-gray-800">
                    <pre id="rawDnsJson" class="text-xs font-mono text-gray-600 dark:text-gray-500 overflow-x-auto whitespace-pre-wrap"></pre>
                </div>
            </details>
        </div>
    </main>

    <footer class="mt-auto py-8 text-center text-gray-500 dark:text-gray-600 text-xs font-medium">
        <p>&copy; <span id="year"></span> SPF Detector Tool. Powered by Google DNS API.</p>
    </footer>

    <script>
        document.getElementById('year').textContent = new Date().getFullYear();

        const SPF_RULES = {
            'ip4': { desc: 'Authorizes a specific IPv4 address or CIDR range.', validation: (v) => !!v },
            'ip6': { desc: 'Authorizes a specific IPv6 address or CIDR range.', validation: (v) => !!v },
            'a': { desc: 'Authorizes IP addresses from the domain\'s A records.', validation: () => true },
            'mx': { desc: 'Authorizes IP addresses from the domain\'s MX records.', validation: () => true },
            'include': { desc: 'Includes another domain\'s SPF record.', validation: (v) => !!v },
            'redirect': { desc: 'Redirects SPF processing to another domain.', validation: (v) => !!v },
            'ptr': { desc: 'Uses reverse DNS lookup (Deprecated).', isDeprecated: true, validation: () => false },
            'exists': { desc: 'Checks if a domain name resolves to any address.', validation: (v) => !!v },
            'all': { desc: 'Matches all other IPs (final policy).', validation: () => true }
        };

        const htmlEl = document.documentElement;
        const themeIcon = document.getElementById('themeIcon');
        
        if (localStorage.getItem('theme') === 'light') {
            htmlEl.classList.remove('dark');
            themeIcon.className = 'fas fa-moon';
        }

        function toggleTheme() {
            if (htmlEl.classList.contains('dark')) {
                htmlEl.classList.remove('dark');
                localStorage.setItem('theme', 'light');
                themeIcon.className = 'fas fa-moon';
            } else {
                htmlEl.classList.add('dark');
                localStorage.setItem('theme', 'dark');
                themeIcon.className = 'fas fa-sun';
            }
        }

        async function handleLookup(e) {
            e.preventDefault();
            const domainInput = document.getElementById('domainInput');
            const selectorInput = document.getElementById('selectorInput');
            let domain = domainInput.value.trim().replace(/^https?:\/\//, '').replace(/\/$/, '');
            let selector = selectorInput.value || 'selector1';
            
            if (!domain) return;

            const loading = document.getElementById('loading');
            const results = document.getElementById('results');
            const submitBtn = document.getElementById('submitBtn');
            
            loading.classList.remove('hidden');
            results.classList.add('hidden');
            submitBtn.disabled = true;

            const logs = { domain, timestamp: new Date().toISOString(), queries: [] };

            try {

                const [spfData, dmarcData, dkimData] = await Promise.all([
                    fetchDNS(domain, 'TXT'),
                    fetchDNS(`_dmarc.${domain}`, 'TXT'),
                    fetchDNS(`${selector}._domainkey.${domain}`, 'TXT')
                ]);

                logs.queries.push({ type: 'SPF', response: spfData });
                logs.queries.push({ type: 'DMARC', response: dmarcData });
                logs.queries.push({ type: 'DKIM', response: dkimData });

                document.getElementById('rawDnsJson').textContent = JSON.stringify(logs, null, 2);

                renderSPF(spfData, domain);
                renderDMARC(dmarcData, domain);
                renderDKIM(dkimData, selector, domain);

            } catch (error) {
                console.error(error);
                setBanner('error', 'Network Error', 'Failed to reach DNS service.');
            } finally {
                loading.classList.add('hidden');
                results.classList.remove('hidden');
                submitBtn.disabled = false;
            }
        }

        async function fetchDNS(name, type) {
            const res = await fetch(`https://dns.google/resolve?name=${name}&type=${type}`);
            return await res.json();
        }

        function extractTxt(data, prefix) {
            if (!data.Answer) return null;
            const records = data.Answer.filter(a => a.type === 16).map(a => a.data.replace(/^"|"$/g, '').replace(/" "/g, ''));
            return prefix ? records.find(r => r.toLowerCase().startsWith(prefix.toLowerCase())) : records[0];
        }

        function renderSPF(data, domain) {
            const rawEl = document.getElementById('spfRaw');
            const breakdownCont = document.getElementById('breakdownContainer');
            const record = extractTxt(data, 'v=spf1');

            if (!record) {
                setBanner('error', 'No Valid SPF Record Found', `The domain ${domain} is missing an SPF record.`);
                rawEl.textContent = "No SPF record found.";
                breakdownCont.classList.add('hidden');
                return;
            }

            rawEl.textContent = record;
            breakdownCont.classList.remove('hidden');
            
            const mechanisms = parseSPF(record);
            renderBreakdownTable(mechanisms);

            if (record.includes('-all')) setBanner('success', 'Valid SPF Record (Hard Fail)', 'Strict policy (-all) enforced.');
            else if (record.includes('~all')) setBanner('warning', 'Valid SPF Record (Soft Fail)', 'Uses permissive soft fail (~all).');
            else setBanner('warning', 'Valid SPF Record', 'Record present but policy is not strict.');
        }

        function renderDMARC(data, domain) {
            const rawEl = document.getElementById('dmarcRaw');
            const badgeEl = document.getElementById('dmarcStatusBadge');
            const record = extractTxt(data, 'v=DMARC1');

            if (!record) {
                badgeEl.innerHTML = '<span class="text-rose-500 text-xs font-bold">MISSING</span>';
                rawEl.textContent = "No DMARC record found at _dmarc." + domain;
                return;
            }

            const pMatch = record.match(/p=([^;]+)/);
            const policy = pMatch ? pMatch[1].toUpperCase() : 'NONE';
            badgeEl.innerHTML = `<span class="text-emerald-500 text-xs font-bold">POLICY: ${policy}</span>`;
            rawEl.textContent = record;
        }

        function renderDKIM(data, selector, domain) {
            const rawEl = document.getElementById('dkimRaw');
            const badgeEl = document.getElementById('dkimStatusBadge');
            const record = extractTxt(data);

            if (!record) {
                badgeEl.innerHTML = '<span class="text-rose-500 text-xs font-bold">NOT FOUND</span>';
                rawEl.textContent = `No record found for selector "${selector}" at _domainkey.${domain}`;
                return;
            }

            badgeEl.innerHTML = '<span class="text-emerald-500 text-xs font-bold">VALID KEY DETECTED</span>';
            rawEl.textContent = record;
        }

        function parseSPF(record) {
            return record.substring(7).trim().split(/\s+/).map(part => {
                let cleanPart = part.replace(/^[-~?+]/, '');
                let [mech, val] = cleanPart.split(/[:=]/);
                const rule = SPF_RULES[mech] || { desc: 'Mechanism/Parameter' };
                return { full: part, mech: mech, desc: rule.desc, isWarning: rule.isDeprecated };
            });
        }

        function renderBreakdownTable(items) {
            const tbody = document.getElementById('breakdownBody');
            tbody.innerHTML = items.map(item => `
                <tr class="hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors">
                    <td class="px-5 py-4 border-b border-gray-100 dark:border-gray-800"><i class="fas fa-check text-emerald-500"></i></td>
                    <td class="px-5 py-4 font-bold text-indigo-700 dark:text-indigo-300 border-b border-gray-100 dark:border-gray-800">${item.mech}</td>
                    <td class="px-5 py-4 text-gray-800 dark:text-gray-300 border-b border-gray-100 dark:border-gray-800 font-mono text-xs">${item.full}</td>
                    <td class="px-5 py-4 text-gray-600 dark:text-gray-400 border-b border-gray-100 dark:border-gray-800 text-xs">${item.desc}</td>
                </tr>
            `).join('');
        }

        function setBanner(type, title, description) {
            const banner = document.getElementById('statusBanner');
            const icon = document.getElementById('statusIcon');
            const titleEl = document.getElementById('statusTitle');
            const descEl = document.getElementById('statusDesc');

            banner.className = "rounded-xl p-5 border-l-4 flex items-start gap-4 shadow-md transition-all duration-300 " + 
                (type === 'success' ? 'bg-emerald-50 dark:bg-emerald-900/20 border-emerald-500' : 
                 type === 'warning' ? 'bg-amber-50 dark:bg-amber-900/20 border-amber-500' : 
                 'bg-rose-50 dark:bg-rose-900/20 border-rose-500');
            
            icon.innerHTML = `<i class="fas ${type === 'success' ? 'fa-check-circle text-emerald-500' : type === 'warning' ? 'fa-exclamation-triangle text-amber-500' : 'fa-times-circle text-rose-500'} text-2xl"></i>`;
            titleEl.textContent = title;
            descEl.textContent = description;
        }

        function copyToClipboard(id) {
            const text = document.getElementById(id).textContent;
            navigator.clipboard.writeText(text);
        }
    </script>
</body>
</html>
